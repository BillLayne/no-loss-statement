<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No Loss Statement - Bill Layne Insurance Agency</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 10px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        /* Language Toggle Styles */
        .language-toggle {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            gap: 5px;
            background: rgba(255,255,255,0.2);
            padding: 5px;
            border-radius: 8px;
        }
        
        .lang-btn {
            padding: 5px 12px;
            border: none;
            background: transparent;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .lang-btn.active {
            background: white;
            color: #2a5298;
        }
        
        .lang-btn:hover:not(.active) {
            background: rgba(255,255,255,0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .header h2 {
            font-size: 20px;
            font-weight: 400;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .form-container {
            padding: 30px 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
        }
        
        .statement-box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 25px 0;
            border-radius: 8px;
        }
        
        .statement-box h3 {
            color: #2a5298;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .statement-box p {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .signature-container {
            margin: 25px 0;
        }
        
        .signature-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        #signature-pad {
            border: 2px dashed #ddd;
            border-radius: 10px;
            display: block;
            width: 100%;
            height: 200px;
            cursor: crosshair;
            background: white;
            touch-action: none;
        }
        
        .signature-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn-clear {
            background: #f44336;
            color: white;
            flex: 1;
        }
        
        .btn-clear:hover {
            background: #da190b;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            margin-top: 20px;
            font-size: 18px;
            padding: 15px;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .success-message,
        .error-message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            display: none;
        }
        
        .success-message {
            background: #4CAF50;
            color: white;
        }
        
        .error-message {
            background: #f44336;
            color: white;
        }
        
        /* ENHANCED LOADING INDICATOR STYLES - MODAL OVERLAY */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }
        
        .loading.show {
            display: flex;
        }
        
        .loading-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.4s ease-out;
            position: relative;
            border: 3px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(135deg, #667eea 0%, #764ba2 100%) border-box;
        }
        
        .spinner {
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }
        
        .loading-title {
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }
        
        .loading-message {
            font-size: 16px;
            color: #555;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .loading-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%);
            color: #856404;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid #ffc107;
            box-shadow: 0 4px 10px rgba(255, 193, 7, 0.2);
            animation: pulseWarning 2s ease-in-out infinite;
        }
        
        .loading-warning-icon {
            font-size: 24px;
            animation: bounce 1s ease-in-out infinite;
        }
        
        @keyframes pulseWarning {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        
        /* NEW ENHANCED SUCCESS MODAL STYLES */
        .success-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }
        
        .success-modal-overlay.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .success-modal {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.4s ease-out;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scaleIn 0.5s ease-out 0.2s both;
        }
        
        .success-icon svg {
            width: 40px;
            height: 40px;
            stroke: white;
            stroke-width: 3;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            animation: drawCheck 0.6s ease-out 0.5s both;
        }
        
        .success-modal h2 {
            color: #333;
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .success-modal p {
            color: #666;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .success-modal .confirmation-number {
            background: #f0f4ff;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-family: monospace;
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
        }
        
        .success-modal .btn-ok {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            color: white;
            padding: 12px 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .success-modal .btn-ok:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }
        
        @keyframes drawCheck {
            from {
                stroke-dasharray: 50;
                stroke-dashoffset: 50;
            }
            to {
                stroke-dasharray: 50;
                stroke-dashoffset: 0;
            }
        }
        /* END NEW MODAL STYLES */
        
        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #e0e0e0;
        }
        
        .footer img {
            max-width: 150px;
            height: auto;
            margin-bottom: 10px;
        }
        
        .footer p {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
        }
        
        /* Auto-fill notification */
        .autofill-notice {
            background: #4CAF50;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            display: none;
            margin-bottom: 20px;
            border-radius: 8px;
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            .header h1 {
                font-size: 24px;
            }
            
            .header h2 {
                font-size: 18px;
            }
            
            .form-container {
                padding: 20px 15px;
            }
            
            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="date"],
            select {
                font-size: 16px;
                padding: 14px 12px;
            }
            
            .success-modal {
                width: 95%;
                padding: 30px 20px;
            }
            
            .success-icon {
                width: 60px;
                height: 60px;
            }
            
            .success-icon svg {
                width: 30px;
                height: 30px;
            }
            
            .language-toggle {
                position: static;
                margin-bottom: 10px;
                justify-content: center;
                background: rgba(255,255,255,0.1);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-toggle">
                <button class="lang-btn active" onclick="setLanguage('en', event)">English</button>
                <button class="lang-btn" onclick="setLanguage('es', event)">Espa√±ol</button>
            </div>
            <h1>Bill Layne Insurance Agency</h1>
            <h2 data-lang="header-title">Statement of No Loss</h2>
            <p data-lang="header-subtitle">Electronic Signature Authorization</p>
        </div>
        
        <form id="noLossForm" class="form-container">
            <div class="autofill-notice" id="autofillNotice">
                <span data-lang="autofill-notice">‚ú® Form has been pre-filled with your information</span>
            </div>
            
            <div class="form-group">
                <label for="insuranceCompany" data-lang="label-company">Insurance Company *</label>
                <select id="insuranceCompany" name="insuranceCompany" required>
                    <option value="" data-lang="select-company">Select Insurance Company</option>
                    <option value="Nationwide">Nationwide</option>
                    <option value="Progressive">Progressive</option>
                    <option value="National General">National General</option>
                    <option value="Alamance">Alamance</option>
                    <option value="Travelers">Travelers</option>
                    <option value="Foremost">Foremost</option>
                    <option value="Other" data-lang="option-other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="policyNumber" data-lang="label-policy">Policy Number *</label>
                <input type="text" id="policyNumber" name="policyNumber" required data-lang-placeholder="placeholder-policy">
            </div>
            
            <div class="form-group">
                <label for="insuredName" data-lang="label-name">Insured Name (Full Name) *</label>
                <input type="text" id="insuredName" name="insuredName" required placeholder="John Doe">
            </div>
            
            <div class="form-group">
                <label for="email" data-lang="label-email">Email Address *</label>
                <input type="email" id="email" name="email" required placeholder="your@email.com">
            </div>
            
            <div class="form-group">
                <label for="phone" data-lang="label-phone">Phone Number *</label>
                <input type="tel" id="phone" name="phone" required placeholder="(336) 555-1234">
            </div>
            
            <div class="form-group">
                <label for="cancellationDate" data-lang="label-cancel-date">Cancellation/Lapse Date *</label>
                <input type="date" id="cancellationDate" name="cancellationDate" required>
            </div>
            
            <div class="form-group">
                <label for="reinstatementDate" data-lang="label-reinstate-date">Requested Reinstatement Date *</label>
                <input type="date" id="reinstatementDate" name="reinstatementDate" required>
            </div>
            
            <div class="form-group">
                <label for="policyType" data-lang="label-policy-type">Policy Type *</label>
                <select id="policyType" name="policyType" required>
                    <option value="" data-lang="select-policy-type">Select Policy Type</option>
                    <option value="Auto" data-lang="option-auto">Auto Insurance</option>
                    <option value="Home" data-lang="option-home">Homeowners Insurance</option>
                    <option value="Renters" data-lang="option-renters">Renters Insurance</option>
                    <option value="Life" data-lang="option-life">Life Insurance</option>
                    <option value="Business" data-lang="option-business">Business Insurance</option>
                    <option value="Other" data-lang="option-other2">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="amountPaid" data-lang="label-amount">Amount Paid for Reinstatement *</label>
                <input type="text" id="amountPaid" name="amountPaid" required placeholder="$0.00">
                <small style="display: block; margin-top: 5px; color: #666; font-size: 12px; font-style: italic;" data-lang="fees-disclaimer">
                    *fees included in Total Amount Required to Reinstate
                </small>
            </div>
            
            <div class="statement-box">
                <h3 data-lang="statement-title">üìã Statement of No Loss</h3>
                <div data-lang="statement-text">
                    <p>
                        I state that neither I nor any other person covered by this policy has had a claim or loss or been involved in an accident since the cancellation or expiration of the policy (otherwise known as the "no loss period") wherein this policy, including any and all coverages endorsed upon or made part of the policy may apply. In addition, if this reinstatement is for a personal or commercial auto, motorcycle, or RV policy, I certify that I have disclosed the current garaging location and use of all insured vehicles including if any such vehicle is used to deliver food or goods, to transport people for compensation, or for any other business purpose. I have also disclosed household members who are age 14 or older, and all persons who regularly drive any vehicle insured under this policy.
                    </p>
                    <p style="margin-top: 10px;">
                        I understand that this insurance company is relying solely upon this Statement of No Loss all of which is material, as an inducement to reinstate my policy with no lapse in coverage. I further understand that if a claim, loss, or accident has occurred during the no loss period, or if I failed to disclose the current garaging location and primary use of all vehicles insured under this policy, all persons who regularly drive these vehicles, and all members of my household who are age 14 or older, the reinstatement is null and void, my policy remains cancelled and no insurance coverage shall be provided.
                    </p>
                    <p style="margin-top: 10px;">
                        I agree that if my check or other payment for this reinstatement is not honored for any reason, the reinstatement is null and void and no coverage shall exist under this policy. I agree to pay a reinstatement fee and late fee (if applicable) in addition to the premium required to reinstate my policy. My payment will be applied first to the reinstatement and late fee and the remainder to the premium.
                    </p>
                    <p style="margin-top: 10px; font-weight: bold;">
                        It is a crime to knowingly provide false, incomplete, or misleading information to an insurance company for the purpose of defrauding the company. Penalties include imprisonment, fines, and denial of insurance benefits.
                    </p>
                    <p style="margin-top: 10px; font-weight: bold;">
                        Do you understand and agree to these statements, terms, and conditions?
                    </p>
                </div>
            </div>
            
            <div class="form-group" style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <label style="display: flex; align-items: flex-start; cursor: pointer; font-weight: normal;">
                    <input type="checkbox" id="agreeTerms" name="agreeTerms" required style="width: auto; margin-right: 10px; margin-top: 3px; transform: scale(1.2);">
                    <span style="color: #333; font-size: 15px; line-height: 1.5;" data-lang="agree-checkbox">
                        I have read, understand, and agree to all the statements, terms, and conditions outlined above in the Statement of No Loss.
                    </span>
                </label>
            </div>
            
            <div class="signature-container">
                <div class="signature-label">
                    <label data-lang="label-signature">Electronic Signature *</label>
                    <span style="color: #666; font-size: 12px;" data-lang="signature-instruction">Draw your signature below</span>
                </div>
                <canvas id="signature-pad"></canvas>
                <div class="signature-buttons">
                    <button type="button" class="btn btn-clear" onclick="clearSignature()" data-lang="btn-clear">Clear Signature</button>
                </div>
            </div>
            
            <!-- EXISTING HIDDEN FIELDS -->
            <input type="hidden" id="signature" name="signature">
            <input type="hidden" id="confirmationNumber" name="confirmationNumber">
            
            <!-- NEW SIGNATURE VERIFICATION DATA FIELDS -->
            <input type="hidden" id="ipAddress" name="ipAddress">
            <input type="hidden" id="sessionId" name="sessionId">
            <input type="hidden" id="deviceInfo" name="deviceInfo">
            <input type="hidden" id="browserFingerprint" name="browserFingerprint">
            <input type="hidden" id="signatureMetadata" name="signatureMetadata">
            <input type="hidden" id="signatureDateTime" name="signatureDateTime">
            <input type="hidden" id="signatureTime" name="signatureTime">
            <input type="hidden" id="timezone" name="timezone">
            <input type="hidden" id="screenResolution" name="screenResolution">
            <input type="hidden" id="formVersion" name="formVersion" value="v2.0.0">
            <input type="hidden" id="submissionMethod" name="submissionMethod" value="Online Portal">
            
            <div class="success-message" id="successMessage">
                <span data-lang="success-msg">‚úÖ Your Statement of No Loss has been successfully submitted!</span>
            </div>
            
            <div class="error-message" id="errorMessage">
                <span data-lang="error-msg">‚ùå There was an error submitting your form. Please try again.</span>
            </div>
            
            <!-- ENHANCED LOADING INDICATOR -->
            <div class="loading" id="loading">
                <div class="loading-content">
                    <div class="spinner"></div>
                    <div class="loading-title" data-lang="loading-title">Please Wait - Uploading Your Signature</div>
                    <div class="loading-message" data-lang="loading-message">
                        Your Statement of No Loss is being securely uploaded.<br>
                        You will receive your confirmation number shortly.
                    </div>
                    <div class="loading-warning">
                        <span class="loading-warning-icon">‚ö†Ô∏è</span>
                        <span data-lang="loading-warning">Do not close this page until upload is complete</span>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-submit" id="submitBtn" data-lang="btn-submit">
                Submit Statement of No Loss
            </button>
        </form>
        
        <div class="footer">
            <p>
                Bill Layne Insurance Agency<br>
                1283 N Bridge St, Elkin NC 28621<br>
                üìû 336-835-1993 | ‚úâÔ∏è Save@BillLayneInsurance.com<br>
                üåê www.BillLayneInsurance.com
            </p>
        </div>
    </div>

    <!-- NEW SUCCESS MODAL -->
    <div class="success-modal-overlay" id="successModalOverlay">
        <div class="success-modal">
            <div class="success-icon">
                <svg viewBox="0 0 24 24">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
            <h2 data-lang="modal-title">Successfully Submitted!</h2>
            <p data-lang="modal-text">Your Statement of No Loss has been received and processed successfully.</p>
            <div class="confirmation-number" id="confirmationDisplay">
                <span data-lang="modal-confirmation">Confirmation #:</span> <span id="confirmNumber"></span>
            </div>
            <p style="font-size: 14px; color: #888;" data-lang="modal-email">
                A confirmation email has been sent to your registered email address.
            </p>
            <button class="btn-ok" onclick="closeSuccessModal()">OK</button>
        </div>
    </div>
    <!-- END NEW SUCCESS MODAL -->

    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwMR6JkqwOFjLUR4BRo7QE0mRiEwKxbcpdCDwJi5AKOmM4MMorM1EROWYMcH7gH1Vke/exec';
        
        let signaturePad;
        let currentConfirmationNumber = '';
        let currentLanguage = 'en';
        let currentSessionId = '';
        let capturedIPAddress = '';
        
        // ============================================
        // SIGNATURE VERIFICATION DATA CAPTURE FUNCTIONS
        // ============================================
        
        // Generate unique session ID
        function generateSessionId() {
            const timestamp = Date.now();
            const random = Math.random().toString(36).substring(2, 9);
            return `NOL-SESSION-${timestamp}-${random}`;
        }
        
        // Get IP address from external service with fallbacks
        async function getIPAddress() {
            try {
                // Primary service
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error('Primary IP service failed, trying backup...');
                try {
                    // Backup service
                    const response2 = await fetch('https://ipapi.co/json/');
                    const data2 = await response2.json();
                    return data2.ip;
                } catch (error2) {
                    console.error('All IP services failed');
                    return 'Unable to capture';
                }
            }
        }
        
        // Capture device information
        function getDeviceInfo() {
            const userAgent = navigator.userAgent;
            let os = 'Unknown OS';
            let browser = 'Unknown Browser';
            let device = 'Desktop';
            
            // Detect OS
            if (userAgent.indexOf('Windows NT 10.0') > -1) os = 'Windows 10';
            else if (userAgent.indexOf('Windows NT 11.0') > -1) os = 'Windows 11';
            else if (userAgent.indexOf('Mac OS X') > -1) os = 'Mac OS X';
            else if (userAgent.indexOf('Android') > -1) os = 'Android';
            else if (userAgent.indexOf('iPhone') > -1) os = 'iOS';
            else if (userAgent.indexOf('Linux') > -1) os = 'Linux';
            
            // Detect Browser
            if (userAgent.indexOf('Chrome') > -1 && userAgent.indexOf('Edg') === -1) browser = 'Chrome';
            else if (userAgent.indexOf('Safari') > -1 && userAgent.indexOf('Chrome') === -1) browser = 'Safari';
            else if (userAgent.indexOf('Firefox') > -1) browser = 'Firefox';
            else if (userAgent.indexOf('Edg') > -1) browser = 'Edge';
            
            // Detect Device Type
            if (/Mobile|Android|iPhone/i.test(userAgent)) {
                device = /Tablet|iPad/i.test(userAgent) ? 'Tablet' : 'Mobile';
            }
            
            return `${device} - ${os} - ${browser}`;
        }
        
        // Generate browser fingerprint
        function generateBrowserFingerprint() {
            const data = [
                navigator.userAgent,
                navigator.language,
                screen.width + 'x' + screen.height,
                screen.colorDepth,
                new Date().getTimezoneOffset(),
                navigator.hardwareConcurrency || 0,
                navigator.maxTouchPoints || 0
            ].join('|');
            
            let hash = 0;
            for (let i = 0; i < data.length; i++) {
                hash = ((hash << 5) - hash) + data.charCodeAt(i);
                hash = hash & hash;
            }
            
            return 'FP-' + Math.abs(hash).toString(36).toUpperCase();
        }
        
        // Capture comprehensive metadata for signature verification
        function captureSignatureMetadata() {
            const now = new Date();
            return {
                sessionId: currentSessionId,
                signatureTime: now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true,
                    timeZoneName: 'short'
                }),
                signatureDate: now.toLocaleDateString('en-US'),
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                userAgent: navigator.userAgent,
                screenResolution: `${screen.width}x${screen.height}`,
                colorDepth: screen.colorDepth,
                language: navigator.language,
                languages: navigator.languages ? navigator.languages.join(', ') : navigator.language,
                platform: navigator.platform,
                cookiesEnabled: navigator.cookieEnabled,
                onlineStatus: navigator.onLine,
                hardwareConcurrency: navigator.hardwareConcurrency || 'N/A',
                deviceMemory: navigator.deviceMemory || 'N/A',
                maxTouchPoints: navigator.maxTouchPoints || 0,
                formVersion: 'v2.0.0',
                entryMode: 'Manual',
                browserFingerprint: generateBrowserFingerprint()
            };
        }
        
        // ============================================
        // EXISTING FUNCTIONS (Language, Auto-fill, etc.)
        // ============================================
        
        // Language translations - ENHANCED with new loading messages
        const translations = {
            en: {
                'header-title': 'Statement of No Loss',
                'header-subtitle': 'Electronic Signature Authorization',
                'autofill-notice': '‚ú® Form has been pre-filled with your information',
                'label-company': 'Insurance Company *',
                'select-company': 'Select Insurance Company',
                'option-other': 'Other',
                'label-policy': 'Policy Number *',
                'placeholder-policy': 'Enter your policy number',
                'label-name': 'Insured Name (Full Name) *',
                'label-email': 'Email Address *',
                'label-phone': 'Phone Number *',
                'label-cancel-date': 'Cancellation/Lapse Date *',
                'label-reinstate-date': 'Requested Reinstatement Date *',
                'label-policy-type': 'Policy Type *',
                'select-policy-type': 'Select Policy Type',
                'option-auto': 'Auto Insurance',
                'option-home': 'Homeowners Insurance',
                'option-renters': 'Renters Insurance',
                'option-life': 'Life Insurance',
                'option-business': 'Business Insurance',
                'option-other2': 'Other',
                'label-amount': 'Amount Paid for Reinstatement *',
                'fees-disclaimer': '*fees included in Total Amount Required to Reinstate',
                'statement-title': 'üìã Statement of No Loss',
                'statement-text': `<p>I state that neither I nor any other person covered by this policy has had a claim or loss or been involved in an accident since the cancellation or expiration of the policy (otherwise known as the "no loss period") wherein this policy, including any and all coverages endorsed upon or made part of the policy may apply. In addition, if this reinstatement is for a personal or commercial auto, motorcycle, or RV policy, I certify that I have disclosed the current garaging location and use of all insured vehicles including if any such vehicle is used to deliver food or goods, to transport people for compensation, or for any other business purpose. I have also disclosed household members who are age 14 or older, and all persons who regularly drive any vehicle insured under this policy.</p>
                    <p style="margin-top: 10px;">I understand that this insurance company is relying solely upon this Statement of No Loss all of which is material, as an inducement to reinstate my policy with no lapse in coverage. I further understand that if a claim, loss, or accident has occurred during the no loss period, or if I failed to disclose the current garaging location and primary use of all vehicles insured under this policy, all persons who regularly drive these vehicles, and all members of my household who are age 14 or older, the reinstatement is null and void, my policy remains cancelled and no insurance coverage shall be provided.</p>
                    <p style="margin-top: 10px;">I agree that if my check or other payment for this reinstatement is not honored for any reason, the reinstatement is null and void and no coverage shall exist under this policy. I agree to pay a reinstatement fee and late fee (if applicable) in addition to the premium required to reinstate my policy. My payment will be applied first to the reinstatement and late fee and the remainder to the premium.</p>
                    <p style="margin-top: 10px; font-weight: bold;">It is a crime to knowingly provide false, incomplete, or misleading information to an insurance company for the purpose of defrauding the company. Penalties include imprisonment, fines, and denial of insurance benefits.</p>
                    <p style="margin-top: 10px; font-weight: bold;">Do you understand and agree to these statements, terms, and conditions?</p>`,
                'agree-checkbox': 'I have read, understand, and agree to all the statements, terms, and conditions outlined above in the Statement of No Loss.',
                'label-signature': 'Electronic Signature *',
                'signature-instruction': 'Draw your signature below',
                'btn-clear': 'Clear Signature',
                'btn-submit': 'Submit Statement of No Loss',
                'success-msg': '‚úÖ Your Statement of No Loss has been successfully submitted!',
                'error-msg': '‚ùå There was an error submitting your form. Please try again.',
                'loading-title': 'Please Wait - Uploading Your Signature',
                'loading-message': 'Your Statement of No Loss is being securely uploaded.<br>You will receive your confirmation number shortly.',
                'loading-warning': 'Do not close this page until upload is complete',
                'modal-title': 'Successfully Submitted!',
                'modal-text': 'Your Statement of No Loss has been received and processed successfully.',
                'modal-confirmation': 'Confirmation #:',
                'modal-email': 'A confirmation email has been sent to your registered email address.',
                'alert-agree': 'Please check the box to agree to the terms and conditions before submitting.',
                'alert-signature': 'Please provide your signature before submitting.'
            },
            es: {
                'header-title': 'Declaraci√≥n de No P√©rdida',
                'header-subtitle': 'Autorizaci√≥n de Firma Electr√≥nica',
                'autofill-notice': '‚ú® El formulario ha sido prellenado con su informaci√≥n',
                'label-company': 'Compa√±√≠a de Seguros *',
                'select-company': 'Seleccione Compa√±√≠a de Seguros',
                'option-other': 'Otra',
                'label-policy': 'N√∫mero de P√≥liza *',
                'placeholder-policy': 'Ingrese su n√∫mero de p√≥liza',
                'label-name': 'Nombre del Asegurado (Nombre Completo) *',
                'label-email': 'Correo Electr√≥nico *',
                'label-phone': 'N√∫mero de Tel√©fono *',
                'label-cancel-date': 'Fecha de Cancelaci√≥n/Vencimiento *',
                'label-reinstate-date': 'Fecha de Reinstalaci√≥n Solicitada *',
                'label-policy-type': 'Tipo de P√≥liza *',
                'select-policy-type': 'Seleccione Tipo de P√≥liza',
                'option-auto': 'Seguro de Auto',
                'option-home': 'Seguro de Propietario',
                'option-renters': 'Seguro de Inquilino',
                'option-life': 'Seguro de Vida',
                'option-business': 'Seguro de Negocio',
                'option-other2': 'Otro',
                'label-amount': 'Cantidad Pagada para Reinstalaci√≥n *',
                'fees-disclaimer': '*tarifas incluidas en el Monto Total Requerido para Reinstalar',
                'statement-title': 'üìã Declaraci√≥n de No P√©rdida',
                'statement-text': `<p>Declaro que ni yo ni ninguna otra persona cubierta por esta p√≥liza ha tenido un reclamo o p√©rdida o ha estado involucrado en un accidente desde la cancelaci√≥n o vencimiento de la p√≥liza (tambi√©n conocido como el "per√≠odo sin p√©rdida") en el que esta p√≥liza, incluidas todas y cada una de las coberturas endosadas o que forman parte de la p√≥liza, puedan aplicarse. Adem√°s, si esta reinstalaci√≥n es para una p√≥liza de auto personal o comercial, motocicleta o veh√≠culo recreativo, certifico que he revelado la ubicaci√≥n actual del garaje y el uso de todos los veh√≠culos asegurados, incluyendo si alg√∫n veh√≠culo se usa para entregar alimentos o bienes, para transportar personas por compensaci√≥n, o para cualquier otro prop√≥sito comercial. Tambi√©n he revelado a los miembros del hogar que tienen 14 a√±os o m√°s, y todas las personas que regularmente conducen cualquier veh√≠culo asegurado bajo esta p√≥liza.</p>
                    <p style="margin-top: 10px;">Entiendo que esta compa√±√≠a de seguros conf√≠a √∫nicamente en esta Declaraci√≥n de No P√©rdida, toda la cual es material, como un incentivo para reinstalar mi p√≥liza sin lapso en la cobertura. Adem√°s, entiendo que si ha ocurrido un reclamo, p√©rdida o accidente durante el per√≠odo sin p√©rdida, o si no revel√© la ubicaci√≥n actual del garaje y el uso principal de todos los veh√≠culos asegurados bajo esta p√≥liza, todas las personas que regularmente conducen estos veh√≠culos, y todos los miembros de mi hogar que tienen 14 a√±os o m√°s, la reinstalaci√≥n es nula y sin efecto, mi p√≥liza permanece cancelada y no se proporcionar√° cobertura de seguro.</p>
                    <p style="margin-top: 10px;">Acepto que si mi cheque u otro pago para esta reinstalaci√≥n no es honrado por cualquier raz√≥n, la reinstalaci√≥n es nula y sin efecto y no existir√° cobertura bajo esta p√≥liza. Acepto pagar una tarifa de reinstalaci√≥n y una tarifa por pago tard√≠o (si corresponde) adem√°s de la prima requerida para reinstalar mi p√≥liza. Mi pago se aplicar√° primero a la tarifa de reinstalaci√≥n y tard√≠a y el resto a la prima.</p>
                    <p style="margin-top: 10px; font-weight: bold;">Es un delito proporcionar informaci√≥n falsa, incompleta o enga√±osa a sabiendas a una compa√±√≠a de seguros con el prop√≥sito de defraudar a la compa√±√≠a. Las sanciones incluyen encarcelamiento, multas y denegaci√≥n de beneficios del seguro.</p>
                    <p style="margin-top: 10px; font-weight: bold;">¬øEntiende y est√° de acuerdo con estas declaraciones, t√©rminos y condiciones?</p>`,
                'agree-checkbox': 'He le√≠do, entiendo y acepto todas las declaraciones, t√©rminos y condiciones descritos anteriormente en la Declaraci√≥n de No P√©rdida.',
                'label-signature': 'Firma Electr√≥nica *',
                'signature-instruction': 'Dibuje su firma abajo',
                'btn-clear': 'Borrar Firma',
                'btn-submit': 'Enviar Declaraci√≥n de No P√©rdida',
                'success-msg': '‚úÖ ¬°Su Declaraci√≥n de No P√©rdida ha sido enviada exitosamente!',
                'error-msg': '‚ùå Hubo un error al enviar su formulario. Por favor intente de nuevo.',
                'loading-title': 'Por Favor Espere - Subiendo Su Firma',
                'loading-message': 'Su Declaraci√≥n de No P√©rdida se est√° subiendo de forma segura.<br>Recibir√° su n√∫mero de confirmaci√≥n en breve.',
                'loading-warning': 'No cierre esta p√°gina hasta que se complete la carga',
                'modal-title': '¬°Enviado Exitosamente!',
                'modal-text': 'Su Declaraci√≥n de No P√©rdida ha sido recibida y procesada exitosamente.',
                'modal-confirmation': 'N√∫mero de Confirmaci√≥n:',
                'modal-email': 'Se ha enviado un correo de confirmaci√≥n a su direcci√≥n de correo electr√≥nico registrada.',
                'alert-agree': 'Por favor marque la casilla para aceptar los t√©rminos y condiciones antes de enviar.',
                'alert-signature': 'Por favor proporcione su firma antes de enviar.'
            }
        };
        
        // FIXED: Language switching function with optional event parameter
        function setLanguage(lang, event) {
            currentLanguage = lang;
            
            // Update button states
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // If event exists (button click), use event.target
            // Otherwise, find the button for the language
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Find and activate the correct button programmatically
                const langButton = document.querySelector(`.lang-btn[onclick*="'${lang}'"]`);
                if (langButton) {
                    langButton.classList.add('active');
                }
            }
            
            // Update all text elements
            document.querySelectorAll('[data-lang]').forEach(element => {
                const key = element.getAttribute('data-lang');
                if (translations[lang][key]) {
                    if (element.tagName === 'DIV' && key === 'statement-text') {
                        element.innerHTML = translations[lang][key];
                    } else if (key === 'loading-message') {
                        element.innerHTML = translations[lang][key];
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
            
            // Update placeholders
            document.querySelectorAll('[data-lang-placeholder]').forEach(element => {
                const key = element.getAttribute('data-lang-placeholder');
                if (translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
            
            // Store language preference
            localStorage.setItem('preferredLanguage', lang);
        }
        
        // ============================================
        // URL PARAMETER AUTO-FILL FUNCTIONALITY
        // ============================================
        function getUrlParameters() {
            const params = new URLSearchParams(window.location.search);
            const paramObject = {};
            for (const [key, value] of params) {
                paramObject[key] = decodeURIComponent(value);
            }
            return paramObject;
        }
        
        function autoFillForm() {
            const params = getUrlParameters();
            let fieldsAutoFilled = false;
            
            // Map URL parameters to form field IDs
            const fieldMapping = {
                'company': 'insuranceCompany',
                'insuranceCompany': 'insuranceCompany',
                'policy': 'policyNumber',
                'policyNumber': 'policyNumber',
                'name': 'insuredName',
                'insuredName': 'insuredName',
                'email': 'email',
                'phone': 'phone',
                'tel': 'phone',
                'cancelDate': 'cancellationDate',
                'cancellationDate': 'cancellationDate',
                'reinstateDate': 'reinstatementDate',
                'reinstatementDate': 'reinstatementDate',
                'type': 'policyType',
                'policyType': 'policyType',
                'amount': 'amountPaid',
                'amountPaid': 'amountPaid'
            };
            
            // Fill in the form fields based on URL parameters
            for (const [urlParam, fieldId] of Object.entries(fieldMapping)) {
                if (params[urlParam]) {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.value = params[urlParam];
                        fieldsAutoFilled = true;
                        
                        // Special handling for amount field to ensure proper formatting
                        if (fieldId === 'amountPaid' && !params[urlParam].startsWith('$')) {
                            field.value = '$' + params[urlParam];
                        }
                    }
                }
            }
            
            // Show notification if fields were auto-filled
            if (fieldsAutoFilled) {
                const notice = document.getElementById('autofillNotice');
                notice.style.display = 'block';
                setTimeout(() => {
                    notice.style.opacity = '0';
                    setTimeout(() => {
                        notice.style.display = 'none';
                        notice.style.opacity = '1';
                    }, 500);
                }, 3000);
            }
        }
        
        // Generate confirmation number
        function generateConfirmationNumber() {
            const date = new Date();
            const year = date.getFullYear().toString().slice(-2);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            return `NOL-${year}${month}${day}-${random}`;
        }
        
        // Close success modal
        function closeSuccessModal() {
            document.getElementById('successModalOverlay').classList.remove('show');
        }
        
        // Show success modal
        function showSuccessModal() {
            document.getElementById('confirmNumber').textContent = currentConfirmationNumber;
            document.getElementById('successModalOverlay').classList.add('show');
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Initializing No Loss Statement form with signature verification...');
            
            // Generate and store session ID immediately
            currentSessionId = generateSessionId();
            document.getElementById('sessionId').value = currentSessionId;
            console.log('Session ID generated:', currentSessionId);
            
            // Capture IP address in background
            getIPAddress().then(ip => {
                capturedIPAddress = ip;
                document.getElementById('ipAddress').value = ip;
                console.log('IP Address captured:', ip);
            }).catch(error => {
                console.error('Failed to capture IP:', error);
                document.getElementById('ipAddress').value = 'Unable to capture';
            });
            
            // Capture device info immediately
            const deviceInfo = getDeviceInfo();
            document.getElementById('deviceInfo').value = deviceInfo;
            console.log('Device info:', deviceInfo);
            
            // Generate and store browser fingerprint
            const fingerprint = generateBrowserFingerprint();
            document.getElementById('browserFingerprint').value = fingerprint;
            console.log('Browser fingerprint:', fingerprint);
            
            // Store additional metadata
            document.getElementById('timezone').value = Intl.DateTimeFormat().resolvedOptions().timeZone;
            document.getElementById('screenResolution').value = `${screen.width}x${screen.height}`;
            
            // Check for language parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const langParam = urlParams.get('lang');
            
            // Set language from URL parameter or saved preference
            if (langParam === 'es') {
                setLanguage('es');
            } else {
                // Check for saved language preference
                const savedLang = localStorage.getItem('preferredLanguage');
                if (savedLang && savedLang !== 'en') {
                    setLanguage(savedLang);
                }
            }
            
            // Auto-fill form from URL parameters
            autoFillForm();
            
            // Initialize signature pad
            const canvas = document.getElementById('signature-pad');
            signaturePad = new SignaturePad(canvas, {
                backgroundColor: 'rgb(255, 255, 255)',
                penColor: 'rgb(0, 0, 0)'
            });
            
            // Resize canvas to proper size
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Close modal when clicking outside
            document.getElementById('successModalOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSuccessModal();
                }
            });
            
            console.log('Form initialization complete with signature verification data');
        });
        
        function resizeCanvas() {
            const canvas = document.getElementById('signature-pad');
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            canvas.getContext('2d').scale(ratio, ratio);
            if (signaturePad) {
                signaturePad.clear();
            }
        }
        
        function clearSignature() {
            signaturePad.clear();
        }
        
        // ============================================
        // FORM SUBMISSION WITH SIGNATURE VERIFICATION
        // ============================================
        document.getElementById('noLossForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get alert messages in current language
            const alertAgree = translations[currentLanguage]['alert-agree'];
            const alertSignature = translations[currentLanguage]['alert-signature'];
            
            // Validate agreement checkbox
            if (!document.getElementById('agreeTerms').checked) {
                alert(alertAgree);
                return;
            }
            
            // Validate signature
            if (signaturePad.isEmpty()) {
                alert(alertSignature);
                return;
            }
            
            // Generate confirmation number BEFORE submission
            currentConfirmationNumber = generateConfirmationNumber();
            document.getElementById('confirmationNumber').value = currentConfirmationNumber;
            
            // Capture comprehensive metadata for signature verification
            const metadata = captureSignatureMetadata();
            document.getElementById('signatureMetadata').value = JSON.stringify(metadata);
            
            // Set signature date and time with seconds
            const now = new Date();
            const signatureDateTime = `${now.toLocaleDateString('en-US')} ${metadata.signatureTime}`;
            document.getElementById('signatureDateTime').value = signatureDateTime;
            document.getElementById('signatureTime').value = metadata.signatureTime;
            
            // Get signature data
            document.getElementById('signature').value = signaturePad.toDataURL();
            
            // Log submission for debugging
            console.log('Submitting No Loss Statement with verification data:');
            console.log('- Confirmation #:', currentConfirmationNumber);
            console.log('- Session ID:', currentSessionId);
            console.log('- IP Address:', capturedIPAddress);
            console.log('- Device Info:', document.getElementById('deviceInfo').value);
            console.log('- Signature Time:', metadata.signatureTime);
            console.log('- Browser Fingerprint:', document.getElementById('browserFingerprint').value);
            
            // Show loading modal overlay
            document.getElementById('loading').classList.add('show');
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            
            // Prepare form data
            const formData = new FormData(this);
            formData.append('submissionDate', new Date().toLocaleString());
            formData.append('formType', 'Statement of No Loss');
            formData.append('entryMode', 'Manual');
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.text();
                console.log('Server response:', result);
                
                if (result.includes('Success') || response.ok) {
                    // Show enhanced success modal with confirmation number
                    showSuccessModal();
                    
                    // Also show inline success message
                    document.getElementById('successMessage').style.display = 'block';
                    
                    // Reset form
                    document.getElementById('noLossForm').reset();
                    signaturePad.clear();
                    
                    // Scroll to top
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    throw new Error('Submission failed');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errorMessage').style.display = 'block';
            } finally {
                document.getElementById('loading').classList.remove('show');
                document.getElementById('submitBtn').disabled = false;
            }
        });
        
        // Auto-format phone number
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value.length <= 3) {
                    value = '(' + value;
                } else if (value.length <= 6) {
                    value = '(' + value.slice(0, 3) + ') ' + value.slice(3);
                } else {
                    value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
                }
            }
            e.target.value = value;
        });
        
        // Auto-format amount paid as currency
        document.getElementById('amountPaid').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^\d.]/g, '');
            let parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            if (parts.length === 2 && parts[1].length > 2) {
                value = parts[0] + '.' + parts[1].slice(0, 2);
            }
            if (value && !e.target.value.startsWith('$')) {
                e.target.value = '$' + value;
            } else if (value === '') {
                e.target.value = '';
            }
        });
        
        // Format amount on blur (when user clicks away)
        document.getElementById('amountPaid').addEventListener('blur', function(e) {
            let value = e.target.value.replace(/[^\d.]/g, '');
            if (value) {
                let num = parseFloat(value);
                if (!isNaN(num)) {
                    e.target.value = '$' + num.toFixed(2);
                }
            }
        });
    </script>
</body>
</html>
